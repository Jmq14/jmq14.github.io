<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>Find Median from Data Stream | Mengqing | Where I am</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Mengqing | Where I am">
    <meta name="author" content="Mengqing Jiang">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Mengqing | Where I am" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="https://github.com/lizy14/weixuetang" target="_BLANK" class="animsition-link">WeLearn</a></li>
                    
                        <li><a href="https://github.com/Jmq14/c2llvm-compiler" target="_BLANK" class="animsition-link">c2llvm compiler</a></li>
                    
                        <li><a href="https://github.com/Cyclops-THSS/On-the-Road" target="_BLANK" class="animsition-link">On the Road - a web game</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/Programming/" class="animsition-link">Programming<small>(11)</small></a></li>
				    
				    <li><a href="/categories/Programming/Research/" class="animsition-link">Research<small>(1)</small></a></li>
				    
				    <li><a href="/categories/随笔/" class="animsition-link">随笔<small>(2)</small></a></li>
				    
				</ul>
        	</li>
			
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Mengqing | Where I am</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/Jmq14" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            <li><a href="https://www.facebook.com/profile.php?id=100011041782280" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2015-12-27T02:50:28.000Z" itemprop="datePublished">
          2015-12-26
      </time>
    
    
    | 
    <a href='/tags/C-C/'>C/C++</a>
    
    
</span>
                <h1>Find Median from Data Stream</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<blockquote>
<p>问题描述：<br>Median is the middle value in an ordered integer list. If the size of the list is even, there is no middle value. So the median is the mean of the two middle value.</p>
</blockquote>
<p>找中位数，我自然地想到了平衡排序树，然而平衡只是高度上的，并不能确保根节点的左右子树有相同或者只相差1的结点数。所以就想到了维护两个数组，要求是长度相同或者相差1，其中一个数组所有数都比另一个数组大，每次寻找中位数的时候，只需要先判断两个数组长度是否相等，相等的话就分别取大数组的最小数和小数组的最大数求平均，否则只需要取其一就可以了。<br>由于这道题是不断插入数字，所以需要插入排序，可以选择的有折半插入，堆排序等等，这样插入排序的过程复杂度是O(logN)，而找中位数的复杂度只有O(1)。<br>我先写了折半插入：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MedianFinder</span> </span>&#123;</div><div class="line">private:</div><div class="line">	vector&lt;<span class="built_in">int</span>&gt; upper;</div><div class="line">	vector&lt;<span class="built_in">int</span>&gt; lower;</div><div class="line"></div><div class="line">	<span class="comment">// 折半插入，func默认为1代表升序，否则降序</span></div><div class="line">	<span class="keyword">void</span> binaryInsert(vector&lt;<span class="built_in">int</span>&gt; &amp;s, <span class="built_in">int</span> <span class="built_in">num</span>, <span class="built_in">int</span> func = <span class="number">1</span>) &#123;</div><div class="line">		<span class="keyword">if</span> (s.size()==<span class="number">0</span>) &#123;s.push_back(<span class="built_in">num</span>); <span class="keyword">return</span>;&#125;</div><div class="line">		<span class="built_in">int</span> l = <span class="number">0</span>, r = s.size()<span class="number">-1</span>;</div><div class="line">		vector&lt;<span class="built_in">int</span>&gt;::iterator it = s.begin();</div><div class="line">		<span class="keyword">switch</span> (func)</div><div class="line">		&#123;</div><div class="line">		<span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">			<span class="keyword">while</span> (l&lt;r)&#123;</div><div class="line">				<span class="built_in">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">				<span class="keyword">if</span> (<span class="built_in">num</span> &gt; s[m])&#123;l = m+<span class="number">1</span>; <span class="keyword">continue</span>;&#125;</div><div class="line">				<span class="keyword">if</span> (<span class="built_in">num</span> &lt; s[m])&#123;r = m<span class="number">-1</span>; <span class="keyword">continue</span>;&#125;</div><div class="line">				<span class="keyword">if</span> (<span class="built_in">num</span> == s[m]) &#123;l = m; <span class="keyword">break</span>;&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> (s[l] &lt; <span class="built_in">num</span>) &#123;it += l+<span class="number">1</span>;&#125;</div><div class="line">			<span class="keyword">else</span> &#123;it += l;&#125;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="keyword">while</span> (l&lt;r)&#123;</div><div class="line">				<span class="built_in">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">				<span class="keyword">if</span> (<span class="built_in">num</span> &lt; s[m])&#123;l = m+<span class="number">1</span>; <span class="keyword">continue</span>;&#125;</div><div class="line">				<span class="keyword">if</span> (<span class="built_in">num</span> &gt; s[m])&#123;r = m<span class="number">-1</span>; <span class="keyword">continue</span>;&#125;</div><div class="line">				<span class="keyword">if</span> (<span class="built_in">num</span> == s[m]) &#123;l = m; <span class="keyword">break</span>;&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> (s[l] &gt; <span class="built_in">num</span>) &#123;it += l+<span class="number">1</span>;&#125;</div><div class="line">			<span class="keyword">else</span> &#123;it += l;&#125;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">		s.insert(it, <span class="built_in">num</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">public:</div><div class="line"></div><div class="line">	<span class="comment">// Adds a number into the data structure.</span></div><div class="line">	<span class="keyword">void</span> addNum(<span class="built_in">int</span> <span class="built_in">num</span>) &#123;</div><div class="line">		<span class="keyword">if</span> (upper.empty()) &#123;upper.push_back(<span class="built_in">num</span>); <span class="keyword">return</span>;&#125;</div><div class="line">		<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">if</span> (upper.size() == lower.size())&#123;</div><div class="line">				<span class="built_in">int</span> low = lower.front();</div><div class="line">				<span class="keyword">if</span> (<span class="built_in">num</span> &gt; low)&#123;</div><div class="line">					binaryInsert(upper, <span class="built_in">num</span>);</div><div class="line">				&#125;<span class="keyword">else</span>&#123;</div><div class="line">					upper.insert(upper.begin(), low);</div><div class="line">					lower.erase(lower.begin());</div><div class="line">					binaryInsert(lower, <span class="built_in">num</span>, <span class="number">-1</span>);</div><div class="line">				&#125;</div><div class="line">			&#125;<span class="keyword">else</span> &#123;</div><div class="line">				<span class="built_in">int</span> up = upper.front();</div><div class="line">				<span class="keyword">if</span> (<span class="built_in">num</span> &lt; up)&#123;</div><div class="line">					binaryInsert(lower, <span class="built_in">num</span>, <span class="number">-1</span>);</div><div class="line">				&#125;<span class="keyword">else</span>&#123;</div><div class="line">					lower.insert(lower.begin(), up);</div><div class="line">					upper.erase(upper.begin());</div><div class="line">					binaryInsert(upper, <span class="built_in">num</span>);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Returns the median of current data stream</span></div><div class="line">	<span class="built_in">double</span> findMedian() &#123;</div><div class="line">		<span class="keyword">if</span> (upper.size() &gt; lower.size()) <span class="keyword">return</span> upper[<span class="number">0</span>];</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (upper.size() == lower.size()) <span class="keyword">return</span> (<span class="built_in">double</span>)(upper[<span class="number">0</span>]+lower[<span class="number">0</span>])/<span class="number">2.0</span>;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// Your MedianFinder object will be instantiated and called as such:</span></div><div class="line"><span class="comment">// MedianFinder mf;</span></div><div class="line"><span class="comment">// mf.addNum(1);</span></div><div class="line"><span class="comment">// mf.findMedian();</span></div></pre></td></tr></table></figure></p>
<p>如果用堆排序的话，完全可以使用优先队列（STL的优先队列默认使用的就是堆排序），不仅代码更简洁，而且速度也更快。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">class MedianFinder &#123;</div><div class="line">    priority_queue&lt;int&gt; <span class="built_in">lower</span>;</div><div class="line">    priority_queue&lt;int, <span class="built_in">vector</span>&lt;int&gt;, greater&lt;int&gt; &gt; <span class="built_in">upper</span>;</div><div class="line">public:</div><div class="line"></div><div class="line">    void addNum(int num) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">upper</span>.empty()) &#123;<span class="built_in">upper</span>.<span class="keyword">push</span>(num); <span class="keyword">return</span>;&#125;</div><div class="line">		<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">if</span> (<span class="built_in">upper</span>.size() == <span class="built_in">lower</span>.size())&#123;</div><div class="line">				int low = <span class="built_in">lower</span>.top();</div><div class="line">				<span class="keyword">if</span> (num &gt; low)&#123;</div><div class="line">					<span class="built_in">upper</span>.<span class="keyword">push</span>(num)</div><div class="line">				&#125;<span class="keyword">else</span>&#123;</div><div class="line">					<span class="built_in">upper</span>.<span class="keyword">push</span>(low);</div><div class="line">					<span class="built_in">lower</span>.<span class="keyword">pop</span>();</div><div class="line">					<span class="built_in">lower</span>.<span class="keyword">push</span>(num) ;</div><div class="line">				&#125;</div><div class="line">			&#125;<span class="keyword">else</span> &#123;</div><div class="line">				int up = <span class="built_in">upper</span>.top();</div><div class="line">				<span class="keyword">if</span> (num &lt; up)&#123;</div><div class="line">					<span class="built_in">lower</span>.<span class="keyword">push</span>(num);</div><div class="line">				&#125;<span class="keyword">else</span>&#123;</div><div class="line">					<span class="built_in">lower</span>.<span class="keyword">push</span>(up);</div><div class="line">					<span class="built_in">upper</span>.<span class="keyword">pop</span>();</div><div class="line">					<span class="built_in">upper</span>.<span class="keyword">push</span>(num);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    double findMedian() &#123;</div><div class="line">    	<span class="keyword">if</span> (<span class="built_in">upper</span>.size() &gt; <span class="built_in">lower</span>.size()) <span class="keyword">return</span> <span class="built_in">upper</span>.top();</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">upper</span>.size() == <span class="built_in">lower</span>.size()) <span class="keyword">return</span> (double)(<span class="built_in">upper</span>.top()+<span class="built_in">lower</span>.top())/<span class="number">2.0</span>;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在OJ上运行速度分别是172ms和155ms。</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2016/01/22/CrawlDataFromCloudMusic/" style="float: left;">
        ← 如何优雅地获取网易云音乐数据
    </a>
    
    
    <a class="pull-right" href="/2015/12/20/RotatedArray/">
        RotatedArray →
    </a>
    
</nav>

        <div class="duoshuo">



<div class="ds-thread" data-thread-key="2015/12/26/Find-Median-from-Data-Stream/" data-title="Find Median from Data Stream" data-url="http://jmq14.github.io/2015/12/26/Find-Median-from-Data-Stream/"></div>
<script type="text/javascript">
	var duoshuoQuery = {short_name:"jmq14"};
	window.addEventListener('load', function(){
		(function() {
			var ds = document.createElement('script');
			ds.type = 'text/javascript';ds.async = true;
			ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
			ds.charset = 'UTF-8';
			(document.getElementsByTagName('head')[0]
			|| document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
	});
</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Mengqing Jiang. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/Jmq14" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    <li><a href="https://www.facebook.com/profile.php?id=100011041782280" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      (function(){
        console.log('font');
        var getCss = function(path) {
          var head = document.getElementsByTagName('head')[0];
          link = document.createElement('link');
          link.href = path;
          link.rel = 'stylesheet';
          link.type = 'text/css';
          head.appendChild(link);
        };
        getCss('https://fonts.googleapis.com/css?family=Montserrat:400,700');
        getCss('https://fonts.googleapis.com/css?family=Open+Sans:400,600');
      })();
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
